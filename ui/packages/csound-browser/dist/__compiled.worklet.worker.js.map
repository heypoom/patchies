{
"version":3,
"file":"/Users/poom/Projects/patchies/ui/packages/csound-browser/dist/__compiled.worklet.worker.js",
"lineCount":17,
"mappings":"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",
"sources":["/dist/src/utils/comlink.js","/dist/src/utils/message-port-state.js","/dist/src/logger.js","/dist/src/workers/common.utils.js","/dist/src/constants.js","/dist/src/workers/worklet.worker.js"],
"sourcesContent":["/* eslint-disable */\n// Copyright 2017 Google Inc.\n\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n\n//     http://www.apache.org/licenses/LICENSE-2.0\n\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n// VENDORED DEPENDENCY\n// sadly, comlink doesn't work with advanced google-closure compilation\n// see: https://github.com/GoogleChromeLabs/comlink\n\nconst e = Symbol(\"Comlink.proxy\");\nconst t = Symbol(\"Comlink.endpoint\");\nconst n = Symbol(\"Comlink.releaseProxy\");\nconst r = Symbol(\"Comlink.thrown\");\nconst a = (e) => (\"object\" == typeof e && null !== e) || \"function\" == typeof e;\nconst s = new Map([\n  [\n    \"proxy\",\n    {\n      canHandle: (t) => a(t) && t[e],\n      serialize(e) {\n        const { port1: t, port2: n } = new MessageChannel();\n        return o(e, t), [n, [n]];\n      },\n      deserialize: (e) => (e.start(), c(e, undefined)),\n    },\n  ],\n  [\n    \"throw\",\n    {\n      canHandle: (e) => a(e) && r in e,\n      serialize({ value: e }) {\n        let t;\n        return (\n          (t =\n            e instanceof Error\n              ? { isError: !0, value: { message: e.message, name: e.name, stack: e.stack } }\n              : { isError: !1, value: e }),\n          [t, []]\n        );\n      },\n      deserialize(e) {\n        if (e.isError) throw Object.assign(new Error(e.value.message), e.value);\n        throw e.value;\n      },\n    },\n  ],\n]);\nfunction o(e, t = self) {\n  t.addEventListener(\"message\", function n(a) {\n    if (!a || !a.data) return;\n    const argumentList = a[\"data\"][\"argumentList\"];\n    const { id: s, type: c, path: u } = Object.assign({ path: [] }, a[\"data\"]);\n    const l = (argumentList || []).map(E);\n\n    let p;\n    try {\n      const t = u.slice(0, -1).reduce((e, t) => e[t], e),\n        n = u.reduce((e, t) => e[t], e);\n      switch (c) {\n        case \"GET\":\n          p = n;\n          break;\n        case \"SET\":\n          (t[u.slice(-1)[0]] = E(a.data.value)), (p = !0);\n          break;\n        case \"APPLY\":\n          // console.log(\"N.apply\", n, t, l);\n          p = n.apply(t, l);\n          break;\n        case \"CONSTRUCT\":\n          p = d(new n(...l));\n          break;\n        case \"ENDPOINT\":\n          {\n            const { port1: t, port2: n } = new MessageChannel();\n            o(e, n), (p = m(t, [t]));\n          }\n          break;\n        case \"RELEASE\":\n          p = void 0;\n          break;\n        default:\n          return;\n      }\n    } catch (e) {\n      p = { value: e, [r]: 0 };\n    }\n    Promise.resolve(p)\n      .catch((e) => ({ value: e, [r]: 0 }))\n      .then((e) => {\n        const [r, a] = g(e);\n        const message = { ...r };\n        message[\"id\"] = s;\n        t.postMessage(message, a), \"RELEASE\" === c && (t.removeEventListener(\"message\", n), i(t));\n      });\n  }),\n    t.start && t.start();\n}\nfunction i(e) {\n  (function (e) {\n    return \"MessagePort\" === e.constructor.name;\n  })(e) && e.close();\n}\nfunction c(e, r) {\n  return /** @suppress {duplicate} */ (function e(r, a = [], s = function () {}) {\n    let o = false;\n    const c = new Proxy(s, {\n      get(t, s) {\n        if ((u(o), s === n))\n          return () =>\n            h(r, { type: \"RELEASE\", path: a.map((e) => e.toString()) }, undefined).then(() => {\n              i(r), (o = !0);\n            });\n        if (\"then\" === s) {\n          if (0 === a.length) return { then: () => c };\n          const e = h(r, { type: \"GET\", path: a.map((e) => e.toString()) }, undefined).then(E);\n          return e.then.bind(e);\n        }\n        return e(r, [...a, s]);\n      },\n      set(e, t, n) {\n        u(o);\n        const [s, i] = g(n);\n        return h(r, { type: \"SET\", path: [...a, t].map((e) => e.toString()), value: s }, i).then(E);\n      },\n      apply(n, s, i) {\n        u(o);\n        const c = a[a.length - 1];\n        if (c === t) return h(r, { type: \"ENDPOINT\" }, undefined).then(E);\n        if (\"bind\" === c) return e(r, a.slice(0, -1));\n        const [p, m] = l(i);\n\n        /** @noinline */\n        const applyForm = {};\n\n        applyForm[\"type\"] = \"APPLY\";\n\n        applyForm[\"path\"] = a.map((e) => e.toString());\n\n        applyForm[\"argumentList\"] = p;\n\n        return h(r, applyForm, m).then(E);\n      },\n      construct(e, t) {\n        u(o);\n        const [n, s] = l(t);\n        /** @noinline */\n        const constructForm = {};\n        constructForm[\"type\"] = \"CONSTRUCT\";\n        constructForm[\"path\"] = a.map((e) => e.toString());\n        constructForm[\"argumentList\"] = n;\n        return h(r, constructForm, s).then(E);\n      },\n    });\n    return c;\n  })(e, [], r);\n}\nfunction u(e) {\n  if (e) throw new Error(\"Proxy has been released and is not useable\");\n}\nfunction l(e) {\n  const t = e.map(g);\n  /** @suppress {checkVars} */\n  const el2 = ((n = t.map((e) => e[1])), Array.prototype.concat.apply([], n));\n  return [t.map((e) => e[0]), el2];\n  /** @suppress {uselessCode} */\n  var n;\n}\nconst p = new WeakMap();\n\nfunction m(e, t) {\n  return p.set(e, t), e;\n}\n\nfunction d(t) {\n  return Object.assign(t, { [e]: !0 });\n}\n\nfunction f(e, t = self, n = \"*\") {\n  return {\n    postMessage: (t, r) => e.postMessage(t, n, r),\n    addEventListener: t.addEventListener.bind(t),\n    removeEventListener: t.removeEventListener.bind(t),\n  };\n}\nfunction g(e) {\n  for (const [t, n] of s)\n    if (n.canHandle(e)) {\n      const [r, a] = n.serialize(e);\n      return [{ type: \"HANDLER\", name: t, value: r }, a];\n    }\n  return [{ type: \"RAW\", value: e }, p.get(e) || []];\n}\nfunction E(e) {\n  switch (e.type) {\n    case \"HANDLER\":\n      return s.get(e.name).deserialize(e.value);\n    case \"RAW\":\n      return e.value;\n  }\n}\nfunction h(e, t, n) {\n  return new Promise((r) => {\n    const a = new Array(4)\n      .fill(0)\n      .map(() => Math.floor(Math.random() * Number.MAX_SAFE_INTEGER).toString(16))\n      .join(\"-\");\n    e.addEventListener(\"message\", function t(n) {\n      n.data && n.data.id && n.data.id === a && (e.removeEventListener(\"message\", t), r(n.data));\n    });\n    e.start && e.start();\n    const message = t;\n    message[\"id\"] = a;\n    // console.trace(\"message2\", message);\n    e.postMessage(message, n);\n  });\n}\n\nexport {\n  t as createEndpoint,\n  o as expose,\n  d as proxy,\n  e as proxyMarker,\n  n as releaseProxy,\n  m as transfer,\n  s as transferHandlers,\n  f as windowEndpoint,\n  c as wrap,\n};\n","/**\n * @constructor\n */\nexport function MessagePortState() {}\n\n/**\n * @type {boolean}\n */\nMessagePortState.prototype.ready = false;\n\n/**\n * @type {Function|undefined}\n */\nMessagePortState.prototype.port = undefined;\n\n/**\n * @type {Function}\n */\nMessagePortState.prototype.post = () => {};\n/**\n * @type {Function}\n */\nMessagePortState.prototype.broadcastPlayState = () => {};\n/**\n * @type {string|undefined}\n */\nMessagePortState.prototype.workerState = undefined;\n/**\n * @type {string|undefined}\n */\nMessagePortState.prototype.vanillaWorkerState = undefined;\n\nexport default MessagePortState;\n","import LoggerFactoryNS from \"lines-logger/lib/index.js\";\n\nlet logWorkletMain,\n  logWorkletWorker,\n  logSABMain,\n  logSABWorker,\n  logVANMain,\n  logVANWorker,\n  logIndex,\n  logSinglethreadWorkletMain,\n  logSinglethreadWorkletWorker,\n  logCommonUtils,\n  logWasmModule,\n  logMidiRequest;\n\n/** @define {boolean} */\nconst isProd = goog.define(\"PRODUCTION\", false);\n\nif (isProd) {\n  /**\n   * @suppress {checkTypes}\n   */\n  logWorkletMain = (ignore1) => (ignore2) => {};\n  /**\n   * @suppress {checkTypes}\n   */\n  logWorkletWorker = (ignore1) => (ignore2) => {};\n  /**\n   * @suppress {checkTypes}\n   */\n  logSABMain = (ignore1) => (ignore2) => {};\n  /**\n   * @suppress {checkTypes}\n   */\n  logSABWorker = (ignore1) => (ignore2) => {};\n  /**\n   * @suppress {checkTypes}\n   */\n  logVANMain = (ignore1) => (ignore2) => {};\n  /**\n   * @suppress {checkTypes}\n   */\n  logVANWorker = (ignore1) => (ignore2) => {};\n  /**\n   * @suppress {checkTypes}\n   */\n  logIndex = (ignore1) => (ignore2) => {};\n  /**\n   * @suppress {checkTypes}\n   */\n\n  /**\n   * @suppress {checkTypes}\n   */\n  logSinglethreadWorkletMain = (ignore1) => (ignore2) => {};\n  /**\n   * @suppress {checkTypes}\n   */\n  logSinglethreadWorkletWorker = (ignore1) => (ignore2) => {};\n  /**\n   * @suppress {checkTypes}\n   */\n  logCommonUtils = (ignore1) => (ignore2) => {};\n  /**\n   * @suppress {checkTypes}\n   */\n  logWasmModule = (ignore1) => (ignore2) => {};\n  /**\n   * @suppress {checkTypes}\n   */\n  logMidiRequest = (ignore1) => (ignore2) => {};\n} else {\n  // catches chromium and chrome\n\n  const loggerFactory = new LoggerFactoryNS.LoggerFactory();\n\n  const indexLogger = loggerFactory.getLoggerColor(\"index.js\", \"#1E88E5\");\n  const workletMainLogger = loggerFactory.getLoggerColor(\"WorkletMain\", \"#6D4C41\");\n  const workletWorkerLogger = loggerFactory.getLoggerColor(\"WorkletWorker\", \"#D7CCC8\");\n  const sabMainLogger = loggerFactory.getLoggerColor(\"Sab_Main\", \"#000000\");\n  const sabWorkerLogger = loggerFactory.getLoggerColor(\"Sab_Worker\", \"#222222\");\n  const vanMainLogger = loggerFactory.getLoggerColor(\"Van_Main\", \"#F4511E\");\n  const vanWorkerLogger = loggerFactory.getLoggerColor(\"Van_Worker\", \"#FFAB91\");\n  const singleWorkletMainLogger = loggerFactory.getLoggerColor(\n    \"WorkletSinglethread_Main\",\n    \"#1E88E5\",\n  );\n  const singleWorkletWorkerLogger = loggerFactory.getLoggerColor(\n    \"WorkletSinglethread_Worker\",\n    \"#90CAF9\",\n  );\n  const commonUtilsLogger = loggerFactory.getLoggerColor(\"common.utils.js\", \"#FFD600\");\n  const wasmModuleLogger = loggerFactory.getLoggerColor(\"module.js\", \"#FFF59D\");\n  const midiRequestLogger = loggerFactory.getLoggerColor(\"utils/request-midi.js\", \"#FFD600\");\n\n  logWorkletMain = workletMainLogger.log;\n  logWorkletWorker = workletWorkerLogger.log;\n  logSABMain = sabMainLogger.log;\n  logSABWorker = sabWorkerLogger.log;\n  logVANMain = vanMainLogger.log;\n  logVANWorker = vanWorkerLogger.log;\n  logIndex = indexLogger.log;\n  logSinglethreadWorkletMain = singleWorkletMainLogger.log;\n  logSinglethreadWorkletWorker = singleWorkletWorkerLogger.log;\n  logCommonUtils = commonUtilsLogger.log;\n  logWasmModule = wasmModuleLogger.log;\n  logMidiRequest = midiRequestLogger.log;\n}\n\n/**\n * @suppress {checkTypes}\n */\nexport default (ignore1) => (ignore2) => {};\n\nexport {\n  logWorkletMain,\n  logWorkletWorker,\n  logSABMain,\n  logSABWorker,\n  logVANMain,\n  logVANWorker,\n  logIndex,\n  logSinglethreadWorkletMain,\n  logSinglethreadWorkletWorker,\n  logCommonUtils,\n  logWasmModule,\n  logMidiRequest,\n};\n","import { logCommonUtils as log } from \"../logger.js\";\n\nexport const handleCsoundStart =\n  (workerMessagePort, libraryCsound, wasi, createRealtimeAudioThread, renderFunction) =>\n  (arguments_) => {\n    const csound = arguments_[\"csound\"];\n\n    // If no orchestra was given, we assume realtime daemon mode\n    // otherwise we'll end up rendering forever within the while loop\n    const shouldDemonize = libraryCsound.csoundShouldDaemonize(csound) === 1;\n\n    if (shouldDemonize) {\n      let result = libraryCsound.csoundSetOption(csound, \"--daemon\");\n      result !== 0 && console.error(\"csoundSetOption daemon failed:\", result);\n      result = libraryCsound.csoundSetOption(csound, \"-odac\");\n      result !== 0 && console.error(\"csoundSetOption odac failed:\", result);\n    }\n    const startError = libraryCsound.csoundStart(csound);\n\n    const outputName = libraryCsound.csoundGetOutputName(csound) || \"test.wav\";\n    log(`handleCsoundStart: actual csoundStart result ${startError}, outputName: ${outputName}`)();\n    if (startError !== 0) {\n      workerMessagePort.post(\n        `error: csoundStart failed while trying to render ${outputName},` +\n          \" look out for errors in options and syntax\",\n      );\n    }\n\n    setTimeout(() => {\n      const isRequestingRtMidiInput = libraryCsound[\"_isRequestingRtMidiInput\"](csound);\n      const isExpectingRealtimeOutput =\n        shouldDemonize || isRequestingRtMidiInput || outputName.includes(\"dac\");\n\n      if (isExpectingRealtimeOutput) {\n        createRealtimeAudioThread(arguments_);\n      } else {\n        // Do rendering\n        workerMessagePort.broadcastPlayState(\"renderStarted\");\n        if (renderFunction) {\n          renderFunction(arguments_);\n        } else {\n          // eslint-disable-next-line no-empty\n          while (libraryCsound.csoundPerformKsmps(csound) === 0) {}\n        }\n      }\n    }, 0);\n\n    return startError;\n  };\n\nexport const instantiateAudioPacket = (numberChannels, numberFrames) => {\n  const channels = [];\n  for (let chn = 0; chn < numberChannels; chn++) {\n    channels.push(new Float64Array(numberFrames));\n  }\n  return channels;\n};\n\nexport const renderFunction =\n  ({ libraryCsound, workerMessagePort, wasi }) =>\n  async (payload) => {\n    const csound = payload[\"csound\"];\n    const kr = libraryCsound.csoundGetKr(csound);\n    let lastResult = 0;\n    let cnt = 0;\n\n    while (workerMessagePort.vanillaWorkerState === \"renderStarted\" && lastResult === 0) {\n      lastResult = libraryCsound.csoundPerformKsmps(csound);\n      cnt += 1;\n\n      if (typeof setTimeout === \"function\" && lastResult === 0 && cnt % (kr * 2) === 0) {\n        // this is immediately executed, but allows events to be picked up\n        await new Promise((resolve) => setTimeout(resolve, 0));\n      }\n    }\n\n    workerMessagePort.broadcastPlayState(\"renderEnded\");\n  };\n","export const DEFAULT_BUFFER_LEN = 128;\nexport const MAX_CHANNELS = 32;\nexport const RING_BUFFER_SIZE = 16384;\nexport const MIDI_BUFFER_SIZE = 1024;\nexport const MIDI_BUFFER_PAYLOAD_SIZE = 3;\nexport const CALLBACK_DATA_BUFFER_SIZE = 16384;\n\nexport const initialSharedState = [\n  0, // 1 = csound worker is locked\n  4096, // n = framesRequested (4096 is only initial and will thereafter be max'd to 2048)\n  0, // 1 = Csound is currently performing\n  0, // 1 = Csound is currently rendering\n  0, // 1 = Csound is currently paused\n  0, // 1 = STOP\n  -1, // n = sample rate\n  -1, // n = ksmps\n  -1, // n = nchnls\n  -1, // n = ncnls_i\n  0, // n = if 1 then it's requesting microphone\n  DEFAULT_BUFFER_LEN, // number of samples per process\n  0, // n = buffer read index of output buffer\n  0, // n = buffer write index of output buffer\n  0, // n = number of input buffers available\n  0, // n = number of output buffers available\n  0, // n = if 1 then is requesting rtmidi\n  0, // n = rtmidi buffer index\n  0, // n = available rtmidi events in buffer\n  0, // n = has pending callbacks\n];\n\n// Enum helper for SAB\nexport const AUDIO_STATE = {\n  CSOUND_LOCK: 0,\n  FRAMES_REQUESTED: 1,\n  IS_PERFORMING: 2,\n  IS_RENDERING: 3,\n  IS_PAUSED: 4,\n  STOP: 5,\n  SAMPLE_RATE: 6,\n  KSMPS: 7,\n  NCHNLS: 8,\n  NCHNLS_I: 9,\n  IS_REQUESTING_MIC: 10,\n  BUFFER_LEN: 11,\n  OUTPUT_READ_INDEX: 12,\n  OUTPUT_WRITE_INDEX: 13,\n  AVAIL_IN_BUFS: 14,\n  AVAIL_OUT_BUFS: 15,\n  IS_REQUESTING_RTMIDI: 16,\n  RTMIDI_INDEX: 17,\n  AVAIL_RTMIDI_EVENTS: 18,\n  HAS_PENDING_CALLBACKS: 19,\n};\n\nexport const DATA_TYPE = {\n  NUMBER: 0,\n  STRING: 1,\n  FLOAT_32: 2,\n  FLOAT_64: 3,\n};\n","/* eslint-disable unicorn/require-post-message-target-origin */\n\nimport * as Comlink from \"../utils/comlink.js\";\nimport MessagePortState from \"../utils/message-port-state\";\nimport { AUDIO_STATE, RING_BUFFER_SIZE } from \"../constants\";\nimport { instantiateAudioPacket } from \"./common.utils\";\nimport { logWorkletWorker as log } from \"../logger\";\n\nconst VANILLA_INPUT_WRITE_BUFFER_LEN = 2048;\n\nconst activeNodes = new Map();\n\n/**\n * @function\n * @this {{\n * workerMessagePort: Object,\n * bufferLength: number,\n * }}\n */\nfunction processSharedArrayBuffer(inputs, outputs) {\n  const isPerforming = Atomics.load(this.sharedArrayBuffer, AUDIO_STATE.IS_PERFORMING) === 1;\n  const isPaused = Atomics.load(this.sharedArrayBuffer, AUDIO_STATE.IS_PAUSED) === 1;\n  const isStopped = Atomics.load(this.sharedArrayBuffer, AUDIO_STATE.STOP) === 1;\n\n  if (this.startPromiz) {\n    this.startPromiz();\n    delete this.startPromiz;\n  }\n\n  if (!this.sharedArrayBuffer || isPaused || !isPerforming || isStopped) {\n    this.isPerformingLastTime = isPerforming;\n    this.firstBufferReady = false;\n    this.notifiedOnce = false;\n    // this.preProcessCount = 0;\n\n    // Fix for that chrome 64 bug which doesn't 0 the arrays\n    // https://github.com/csound/web-ide/issues/102#issuecomment-663894059\n    (outputs[0] || []).forEach((array) => array.fill(0));\n    return true;\n  }\n\n  this.isPerformingLastTime = isPerforming;\n\n  const writeableInputChannels = inputs && inputs[0];\n  const writeableOutputChannels = outputs && outputs[0];\n  const bufferLength = writeableOutputChannels[0].length;\n\n  if (this.bufferLength !== bufferLength) {\n    this.bufferLength = bufferLength;\n    Atomics.store(this.sharedArrayBuffer, AUDIO_STATE.BUFFER_LEN, bufferLength);\n  }\n\n  const nextInputWriteIndex =\n    writeableInputChannels && writeableInputChannels.length > 0\n      ? (this.inputWriteIndex + bufferLength) % RING_BUFFER_SIZE\n      : 0;\n\n  const nextOutputReadIndex =\n    writeableOutputChannels && writeableOutputChannels.length > 0\n      ? (this.outputReadIndex + bufferLength) % RING_BUFFER_SIZE\n      : 0;\n\n  if (Atomics.load(this.sharedArrayBuffer, AUDIO_STATE.AVAIL_OUT_BUFS) >= bufferLength) {\n    this.bufferUnderrunCount && (this.bufferUnderrunCount = 0);\n    writeableOutputChannels.forEach((channelBuffer, channelIndex) => {\n      // a simple set, where the len is the destination size and 2nd arg the offset\n\n      channelBuffer.set(\n        this.sabOutputChannels[channelIndex].subarray(\n          this.outputReadIndex,\n          nextOutputReadIndex < this.outputReadIndex ? RING_BUFFER_SIZE : nextOutputReadIndex,\n        ),\n      );\n    });\n\n    if (\n      writeableInputChannels &&\n      writeableInputChannels[0] &&\n      writeableInputChannels[0].length > 0\n    ) {\n      writeableInputChannels.forEach((channelBuffer, channelIndex) => {\n        this.sabInputChannels[channelIndex].set(channelBuffer, this.inputWriteIndex);\n      });\n\n      this.inputWriteIndex = nextInputWriteIndex;\n      // Atomics.store(this.sharedArrayBuffer, AUDIO_STATE.INPUT_WRITE_INDEX, nextInputWriteIndex);\n\n      // increase availability of new input data\n      Atomics.add(\n        this.sharedArrayBuffer,\n        AUDIO_STATE.AVAIL_IN_BUFS,\n        writeableInputChannels[0].length,\n      );\n    }\n\n    this.outputReadIndex = nextOutputReadIndex;\n\n    // subtract the available output buffers, all channels are the same length\n    Atomics.sub(this.sharedArrayBuffer, AUDIO_STATE.AVAIL_OUT_BUFS, bufferLength);\n    Atomics.store(this.sharedArrayBuffer, AUDIO_STATE.OUTPUT_READ_INDEX, this.outputReadIndex);\n  } else {\n    if (this.outputReadIndex > 4098) {\n      console.log(\"buffer underrun\");\n    } else {\n      // a not so pretty way to prevent buffer underrun messages\n      // from being delivered before the first buffers are received\n      return true;\n    }\n\n    this.bufferUnderrunCount += 1;\n    if (this.bufferUnderrunCount === 100) {\n      // 100 buffer Underruns in a row\n      // means a fatal situation and browser\n      // may crash\n      this.workerMessagePort.post(\"FATAL: 100 buffers failed in a row\");\n      this.workerMessagePort.broadcastPlayState(\"realtimePerformanceEnded\");\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/** @this {{\n * pendingFrames: number,\n * }}\n */\nfunction processVanillaBuffers(inputs, outputs) {\n  if (!this.vanillaInitialized) {\n    // this minimizes startup glitches\n    const firstTransferSize = 8192;\n\n    const requestFramesPayload = {};\n    requestFramesPayload[\"readIndex\"] = 0;\n    requestFramesPayload[\"numFrames\"] = firstTransferSize;\n\n    this.audioFramePort.requestFrames(requestFramesPayload);\n    this.pendingFrames += firstTransferSize;\n    this.vanillaInitialized = true;\n    if (this.startPromiz) {\n      this.startPromiz();\n      delete this.startPromiz;\n    }\n    return true;\n  }\n\n  if (!this.vanillaFirstTransferDone) {\n    ((outputs && outputs[0]) || []).forEach((array) => array.fill(0));\n    return true;\n  }\n\n  const writeableInputChannels = inputs && inputs[0];\n  const writeableOutputChannels = outputs && outputs[0];\n  const bufferLength = writeableOutputChannels ? writeableOutputChannels[0].length : 0;\n\n  const nextOutputReadIndex =\n    writeableOutputChannels && writeableOutputChannels.length > 0\n      ? (this.vanillaOutputReadIndex + writeableOutputChannels[0].length) % RING_BUFFER_SIZE\n      : 0;\n\n  const nextInputReadIndex =\n    writeableInputChannels && writeableInputChannels.length > 0\n      ? (this.vanillaInputReadIndex + writeableInputChannels[0].length) % RING_BUFFER_SIZE\n      : 0;\n\n  if (bufferLength && this.vanillaAvailableFrames >= bufferLength) {\n    writeableOutputChannels.forEach((channelBuffer, channelIndex) => {\n      channelBuffer.set(\n        this.vanillaOutputChannels[channelIndex].subarray(\n          this.vanillaOutputReadIndex,\n          nextOutputReadIndex < this.vanillaOutputReadIndex\n            ? RING_BUFFER_SIZE\n            : nextOutputReadIndex,\n        ),\n      );\n    });\n\n    if (writeableInputChannels && writeableInputChannels.length > 0) {\n      writeableInputChannels.forEach((channelBuffer, channelIndex) => {\n        this.vanillaInputChannels[channelIndex].set(channelBuffer, this.vanillaInputReadIndex);\n      });\n      if (nextInputReadIndex % VANILLA_INPUT_WRITE_BUFFER_LEN === 0) {\n        const packet = [];\n        const pastBufferBegin =\n          (nextInputReadIndex === 0 ? RING_BUFFER_SIZE : nextInputReadIndex) -\n          VANILLA_INPUT_WRITE_BUFFER_LEN;\n        const thisBufferEnd = nextInputReadIndex === 0 ? RING_BUFFER_SIZE : nextInputReadIndex;\n        this.vanillaInputChannels.forEach((channelBuffer) => {\n          packet.push(channelBuffer.subarray(pastBufferBegin, thisBufferEnd));\n        });\n        this.audioInputPort.transferInputFrames(packet);\n      }\n    }\n\n    this.vanillaOutputReadIndex = nextOutputReadIndex;\n    this.vanillaInputReadIndex = nextInputReadIndex;\n    this.vanillaAvailableFrames -= bufferLength;\n    this.bufferUnderrunCount = 0;\n  } else {\n    // minimize noise\n    if (this.bufferUnderrunCount > 1 && this.bufferUnderrunCount < 12) {\n      this.workerMessagePort.post(\"Buffer underrun\");\n      this.bufferUnderrunCount += 1;\n    }\n\n    if (this.bufferUnderrunCount === 100) {\n      // 100 buffer Underruns in a row\n      // means a fatal situation and browser\n      // may crash\n      this.workerMessagePort.post(\"FATAL: 100 buffers failed in a row\");\n      this.workerMessagePort.broadcastPlayState(\"realtimePerformanceEnded\");\n      return false;\n    }\n  }\n\n  // 2048 is max buffer\n  const framesRequest = 2048 - this.vanillaAvailableFrames;\n  if (framesRequest > 0) {\n    const futureOutputReadIndex =\n      (this.vanillaAvailableFrames + nextOutputReadIndex + this.pendingFrames) % RING_BUFFER_SIZE;\n\n    const requestFramesPayload = {};\n    requestFramesPayload[\"readIndex\"] = futureOutputReadIndex;\n    requestFramesPayload[\"numFrames\"] = framesRequest;\n    this.audioFramePort.requestFrames(requestFramesPayload);\n    this.pendingFrames += framesRequest;\n  }\n\n  return true;\n}\n\nclass CsoundWorkletProcessor extends AudioWorkletProcessor {\n  constructor({ processorOptions }) {\n    super();\n\n    const contextUid = processorOptions[\"contextUid\"];\n    const inputsCount = processorOptions[\"inputsCount\"];\n    const outputsCount = processorOptions[\"outputsCount\"];\n    const ksmps = processorOptions[\"ksmps\"];\n    const maybeSharedArrayBuffer = processorOptions[\"maybeSharedArrayBuffer\"];\n    const maybeSharedArrayBufferAudioIn = processorOptions[\"maybeSharedArrayBufferAudioIn\"];\n    const maybeSharedArrayBufferAudioOut = processorOptions[\"maybeSharedArrayBufferAudioOut\"];\n\n    this.workerMessagePort = undefined;\n    this.startPromiz = undefined;\n    this.audioFramePort = undefined;\n    this.audioInputPort = undefined;\n\n    const nodeUid = `${contextUid}Node`;\n    activeNodes.set(nodeUid, this);\n    this.messagePortsReady = false;\n    this.currentPlayState = undefined;\n    /** @export */\n    this.pause = this.pause.bind(this);\n    /** @export */\n    this.resume = this.resume.bind(this);\n    this.isPaused = false;\n    // this.sampleRate = sampleRate;\n    this.ksmps = ksmps;\n    this.inputsCount = inputsCount;\n    this.outputsCount = outputsCount;\n    this.inputWriteIndex = 0;\n    this.outputReadIndex = 0;\n    this.bufferUnderrunCount = 0;\n    this.bufferLength = 0;\n\n    // NON-SAB PROCESS\n    this.isPerformingLastTime = false;\n    this.preProcessCount = 0;\n\n    if (maybeSharedArrayBuffer) {\n      this.sharedArrayBuffer = maybeSharedArrayBuffer;\n      this.audioStreamIn = maybeSharedArrayBufferAudioIn;\n      this.audioStreamOut = maybeSharedArrayBufferAudioOut;\n      this.sabOutputChannels = [];\n      this.sabInputChannels = [];\n\n      for (let channelIndex = 0; channelIndex < inputsCount; ++channelIndex) {\n        this.sabInputChannels.push(\n          new Float64Array(this.audioStreamIn, RING_BUFFER_SIZE * channelIndex, RING_BUFFER_SIZE),\n        );\n      }\n\n      for (let channelIndex = 0; channelIndex < outputsCount; ++channelIndex) {\n        this.sabOutputChannels.push(\n          new Float64Array(this.audioStreamOut, RING_BUFFER_SIZE * channelIndex, RING_BUFFER_SIZE),\n        );\n      }\n      this.actualProcess = processSharedArrayBuffer.bind(this);\n    } else {\n      this.vanillaOutputChannels = [];\n      this.vanillaInputChannels = [];\n      this.vanillaOutputReadIndex = 0;\n      this.vanillaInputReadIndex = 0;\n      this.vanillaAvailableFrames = 0;\n      this.pendingFrames = 0;\n\n      this.vanillaInitialized = false;\n      this.vanillaFirstTransferDone = false;\n      this.minBufferSize = 4096;\n      this.vanillaInputChannels = instantiateAudioPacket(inputsCount, RING_BUFFER_SIZE);\n      this.vanillaOutputChannels = instantiateAudioPacket(outputsCount, RING_BUFFER_SIZE);\n\n      this.actualProcess = processVanillaBuffers.bind(this);\n      this.updateVanillaFrames = this.updateVanillaFrames.bind(this);\n    }\n    Comlink.expose({ initialize, pause: this.pause, resume: this.resume }, this.port);\n    log(`Worker thread was constructed`)();\n  }\n\n  initCallbacks({ workerMessagePort, audioInputPort, audioFramePort, startPromiz }) {\n    log(`initCallbacks in worker`)();\n    if (workerMessagePort) {\n      this.workerMessagePort = workerMessagePort;\n    }\n\n    if (audioInputPort) {\n      this.audioInputPort = audioInputPort;\n    }\n    if (audioFramePort) {\n      this.audioFramePort = audioFramePort;\n    }\n    this.messagePortsReady = true;\n    this.startPromiz = startPromiz;\n  }\n\n  updateVanillaFrames({ audioPacket, numFrames, readIndex }) {\n    // aways dec pending Frames even for empty ones\n    this.pendingFrames -= numFrames;\n    if (audioPacket) {\n      for (let channelIndex = 0; channelIndex < this.outputsCount; ++channelIndex) {\n        let hasLeftover = false;\n        let framesLeft;\n        const nextReadIndex = (readIndex + numFrames) % RING_BUFFER_SIZE;\n        if (nextReadIndex < readIndex) {\n          hasLeftover = true;\n          framesLeft = RING_BUFFER_SIZE - readIndex;\n        }\n\n        if (hasLeftover) {\n          this.vanillaOutputChannels[channelIndex].set(\n            audioPacket[channelIndex].subarray(0, framesLeft),\n            readIndex,\n          );\n          this.vanillaOutputChannels[channelIndex].set(\n            audioPacket[channelIndex].subarray(framesLeft),\n            0,\n          );\n        } else {\n          this.vanillaOutputChannels[channelIndex].set(audioPacket[channelIndex], readIndex);\n        }\n      }\n      this.vanillaAvailableFrames += numFrames;\n      if (!this.vanillaFirstTransferDone) {\n        this.vanillaFirstTransferDone = true;\n      }\n    }\n  }\n\n  pause() {\n    this.isPaused = true;\n    this.workerMessagePort.broadcastPlayState(\"realtimePerformancePaused\");\n  }\n\n  resume() {\n    this.isPaused = false;\n    this.workerMessagePort.broadcastPlayState(\"realtimePerformanceResumed\");\n  }\n\n  process(inputs, outputs) {\n    return this.isPaused || !this.messagePortsReady ? true : this.actualProcess(inputs, outputs);\n  }\n}\n\nfunction initMessagePort(payload) {\n  const port = payload[\"port\"];\n  log(`initMessagePort in worker`)();\n  const workerMessagePort = new MessagePortState();\n  workerMessagePort.post = (logMessage) => {\n    const payload = {};\n    payload[\"log\"] = logMessage;\n    port.postMessage(payload);\n  };\n  workerMessagePort.broadcastPlayState = (playStateChange) => {\n    const payload = {};\n    payload[\"playStateChange\"] = playStateChange;\n    port.postMessage(payload);\n  };\n\n  workerMessagePort.ready = true;\n  return workerMessagePort;\n}\n\nfunction initRequestPort({ requestPort, audioNode }) {\n  log(`initRequestPort in worker`)();\n  requestPort.addEventListener(\"message\", (requestPortEvent) => {\n    const audioPacket = requestPortEvent.data[\"audioPacket\"];\n    const readIndex = requestPortEvent.data[\"readIndex\"];\n    const numFrames = requestPortEvent.data[\"numFrames\"];\n    audioNode.updateVanillaFrames({ audioPacket, numFrames, readIndex });\n  });\n\n  const requestFrames = (arguments_) => requestPort.postMessage(arguments_);\n\n  requestPort.start();\n  return {\n    requestFrames,\n    ready: true,\n  };\n}\n\nfunction initAudioInputPort(inputPort) {\n  log(`initAudioInputPort in worker`)();\n  return {\n    ready: false,\n    transferInputFrames: (frames) => inputPort.postMessage(frames),\n  };\n}\n\nconst initialize = async (payload) => {\n  const contextUid = payload[\"contextUid\"];\n  const inputPort = payload[\"inputPort\"];\n  const messagePort = payload[\"messagePort\"];\n  const requestPort = payload[\"requestPort\"];\n\n  const nodeUid = `${contextUid}Node`;\n  const audioNode = activeNodes.get(nodeUid);\n  const workerMessagePort = initMessagePort({ port: messagePort });\n\n  const audioInputPort = initAudioInputPort(inputPort);\n  const audioFramePort = initRequestPort({ requestPort, audioNode });\n  let startPromiz;\n  const startPromise = new Promise((resolve) => {\n    startPromiz = resolve;\n  });\n  audioNode.initCallbacks({ workerMessagePort, audioInputPort, audioFramePort, startPromiz });\n  await startPromise;\n};\n\nregisterProcessor(\"csound-worklet-processor\", CsoundWorkletProcessor);\n"],
"names":["e","Symbol","t","n","r","a","s","Map","canHandle","serialize","MessageChannel","o","deserialize","start","c","Error","isError","value","message","name","stack","Object","assign","self","addEventListener","data","argumentList","u","path","l","map","E","slice","reduce","p","apply","m","Promise","resolve","catch","then","g","postMessage","removeEventListener","i","constructor","close","Proxy","get","h","type","toString","length","bind","set","applyForm","construct","constructForm","undefined","el2","Array","prototype","concat","WeakMap","fill","Math","floor","random","Number","MAX_SAFE_INTEGER","join","id","MessagePortState","ready","port","post","MessagePortState.prototype.post","broadcastPlayState","MessagePortState.prototype.broadcastPlayState","logWorkletWorker","instantiateAudioPacket","numberChannels","channels","chn","push","Float64Array","RING_BUFFER_SIZE","activeNodes","processSharedArrayBuffer","inputs","outputs","isPerforming","Atomics","load","sharedArrayBuffer","IS_PERFORMING","isPaused","IS_PAUSED","isStopped","STOP","startPromiz","forEach","array","writeableInputChannels","writeableOutputChannels","bufferLength","store","BUFFER_LEN","nextInputWriteIndex","inputWriteIndex","nextOutputReadIndex","outputReadIndex","AVAIL_OUT_BUFS","bufferUnderrunCount","channelBuffer","channelIndex","sabOutputChannels","subarray","sabInputChannels","add","AVAIL_IN_BUFS","sub","OUTPUT_READ_INDEX","console","log","workerMessagePort","processVanillaBuffers","vanillaInitialized","audioFramePort","requestFrames","requestFramesPayload","firstTransferSize","pendingFrames","vanillaFirstTransferDone","vanillaOutputReadIndex","nextInputReadIndex","vanillaInputReadIndex","vanillaAvailableFrames","vanillaOutputChannels","vanillaInputChannels","VANILLA_INPUT_WRITE_BUFFER_LEN","packet","pastBufferBegin","thisBufferEnd","audioInputPort","transferInputFrames","framesRequest","initCallbacks","messagePortsReady","CsoundWorkletProcessor","AudioWorkletProcessor","processorOptions","contextUid","inputsCount","outputsCount","maybeSharedArrayBuffer","maybeSharedArrayBufferAudioIn","maybeSharedArrayBufferAudioOut","nodeUid","pause","resume","audioStreamIn","audioStreamOut","actualProcess","updateVanillaFrames","expose","initialize","audioPacket","numFrames","readIndex","hasLeftover","framesLeft","process","initMessagePort","payload","logMessage","workerMessagePort.post","playStateChange","workerMessagePort.broadcastPlayState","initRequestPort","requestPort","audioNode","requestPortEvent","arguments_","initAudioInputPort","inputPort","frames","messagePort","startPromise","registerProcessor"]
}
